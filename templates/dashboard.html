<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #f1f5f9;
      color: #333;
      padding-bottom: 70px;
    }

    header {
      background-color: #1e293b;
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h2 {
      margin: 0;
      font-size: 18px;
    }

    .logout-btn {
      background: #dc2626;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
    }

    main {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 16px;
    }

    .asset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }

    .asset-card {
      background: white;
      border-radius: 16px;
      padding: 18px;
      text-decoration: none;
      color: #1e293b;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .asset-card:hover {
      transform: translateY(-4px);
    }

    .add-asset-btn-primary {
      justify-content: center;
      background: #2563eb;
      color: white;
      font-size: 16px;
      font-weight: 500;
      border-radius: 999px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    table {
      width: 100%;
      background: white;
      border-collapse: collapse;
      border-radius: 14px;
      overflow: hidden;
      margin-top: 20px;
    }

    th, td {
      padding: 12px 14px;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: #e2e8f0;
    }

    .inline-section {
      display: none;
      margin-top: 20px;
    }

    .add-bank-btn {
      display: none;
      margin: 20px 0;
      padding: 10px 18px;
      border-radius: 20px;
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
    }

    .upload-csv-btn {
      margin-left: 10px;
      padding: 10px 18px;
      border-radius: 20px;
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
    }

    #uploadCsvForm input[type="file"] {
      display: none;
    }

    .add-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      z-index: 1000;
    }

    .add-sheet {
      position: fixed;
      bottom: -100%;
      left: 0;
      width: 100%;
      background: white;
      border-radius: 18px 18px 0 0;
      transition: bottom 0.3s ease;
      z-index: 1002;
      max-height: 80vh;
      overflow-y: auto;
    }

    .add-sheet-header {
      display: flex;
      justify-content: space-between;
      padding: 18px 22px;
      border-bottom: 1px solid #e5e7eb;
    }

    .add-item {
      padding: 16px 22px;
      display: flex;
      justify-content: space-between;
      cursor: pointer;
    }

    .add-item:hover {
      background: #f1f5f9;
    }

    #uploadCsvForm {
      display: none;
    }
  </style>
</head>

<body>

<header>
  <h2>Dashboard</h2>
  <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
</header>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <script>
      {% for category, message in messages %}
        alert("{{ message }}");
      {% endfor %}
    </script>
  {% endif %}
{% endwith %}

<main>

<h1>Welcome to the Dashboard</h1>

<div class="asset-grid">

  <a href="{{ url_for('bank.bank_transactions') }}" class="asset-card">Bank Transactions</a>
  <a href="{{ url_for('fd.fd_transactions') }}" class="asset-card">FD Transactions</a>
  <a href="{{ url_for('equity.equity_transactions') }}" class="asset-card">Equity</a>
  <a href="{{ url_for('mf.mf_transactions') }}" class="asset-card">Mutual Fund</a>
  <a href="{{ url_for('pf.pf_transactions') }}" class="asset-card">PF</a>
  <a href="{{ url_for('category_mapping.category_mapping') }}" class="asset-card">Category Mapping</a>

  {% if gold_exists %}
  <a href="javascript:void(0)" class="asset-card" onclick="toggleGold()">Gold</a>
  {% endif %}

    {% if real_estate_exists %}
  <a href="javascript:void(0)" class="asset-card" onclick="toggleSection('realEstateSection')">Real Estate</a>
  {% endif %}

  {% if cash_exists %}
  <a href="javascript:void(0)" class="asset-card" onclick="toggleSection('cashSection')">Cash Investments</a>
  {% endif %}

  {% if private_equity_exists %}
  <a href="javascript:void(0)" class="asset-card" onclick="toggleSection('peSection')">Private Equity</a>
  {% endif %}

  <div class="asset-card add-asset-btn-primary" onclick="openAddSheet()">Add Asset</div>

</div>

<button id="addBankBtn" class="add-bank-btn">Add Transaction</button>

<form id="uploadCsvForm" method="POST" action="/upload_csv" enctype="multipart/form-data">
  <input type="file" name="csv_file" id="csvFileInput" />
  <input type="hidden" name="table_name" id="csvTableName" />
  <button type="button" class="upload-csv-btn" onclick="triggerCsvUpload()">Upload CSV</button>
</form>

{% if gold_exists %}
<div id="goldSection" class="inline-section">
  <h2>Gold Investments</h2>
  {% if gold_investments %}
  <table>
    <thead>
      <tr>
        {% for k in gold_investments[0].keys() %}
          {% if k != 'user_id' %}
            <th>{{ k }}</th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in gold_investments %}
      <tr>
        {% for k in gold_investments[0].keys() %}
          {% if k != 'user_id' %}
            <td>{{ row[k] }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No gold investments yet.</p>
  {% endif %}
</div>
{% endif %}

  <!-- REAL ESTATE -->
{% if real_estate_exists %}
<div id="realEstateSection" class="inline-section">
  <h2>Real Estate</h2>
  <table>
    <thead>
      <tr>
        {% for k in real_estate[0].keys() %}
          {% if k != 'user_id' %}
            <th>{{ k }}</th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in real_estate %}
      <tr>
        {% for k in real_estate[0].keys() %}
          {% if k != 'user_id' %}
            <td>{{ row[k] }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

    <!-- CASH -->
{% if cash_exists %}
<div id="cashSection" class="inline-section">
  <h2>Cash Investments</h2>
  <table>
    <thead>
      <tr>
        {% for k in cash[0].keys() %}
          {% if k != 'user_id' %}
            <th>{{ k }}</th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in cash %}
      <tr>
        {% for k in cash[0].keys() %}
          {% if k != 'user_id' %}
            <td>{{ row[k] }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

    <!-- PRIVATE EQUITY -->
{% if private_equity_exists %}
<div id="peSection" class="inline-section">
  <h2>Private Equity Investments</h2>
  <table>
    <thead>
      <tr>
        {% for k in private_equity[0].keys() %}
          {% if k != 'user_id' %}
            <th>{{ k }}</th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in private_equity %}
      <tr>
        {% for k in private_equity[0].keys() %}
          {% if k != 'user_id' %}
            <td>{{ row[k] }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<div id="transactionsSection">
  {% if transactions %}
  <h2>{{ title }}</h2>
  <table>
    <thead>
      <tr>
        {% for k in transactions[0].keys() %}
          {% if k != 'user_id' %}
            <th>{{ k }}</th>
          {% endif %}
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in transactions %}
      <tr>
        {% for k in transactions[0].keys() %}
          {% if k != 'user_id' %}
            <td>{{ row[k] }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>

<div id="addOverlay" class="add-overlay" onclick="closeAddSheet()"></div>

<div id="addSheet" class="add-sheet">
  <div class="add-sheet-header">
    <span>Select Asset type</span>
    <button onclick="closeAddSheet()">âœ•</button>
  </div>

  <div class="add-item" onclick="goTo('/add_gold_transaction')">Gold</div>
  <div class="add-item" onclick="goTo('/add_real_estate')">Real Estate</div>
  <div class="add-item" onclick="goTo('/add/esops')">ESOPs / RSUs</div>
  <div class="add-item" onclick="goTo('/add_private_equity')">Private Equity</div>
  <div class="add-item" onclick="goTo('/add_cash_investment')">Cash Investments</div>
  <div class="add-item" onclick="goTo('/add/digital-assets')">Digital Assets</div>
</div>

</main>

<script>
function toggleSection(sectionId) {
  const allSections = document.querySelectorAll('.inline-section');
  const tx = document.getElementById("transactionsSection");

  allSections.forEach(sec => sec.style.display = "none");

  const active = document.getElementById(sectionId);
  if (active) active.style.display = "block";

  if (tx) tx.style.display = "none";
}

function toggleGold() {
  const allSections = document.querySelectorAll('.inline-section');
  const tx = document.getElementById("transactionsSection");
  const gold = document.getElementById("goldSection");

  // Hide all sections first
  allSections.forEach(sec => sec.style.display = "none");

  // Show only gold
  if (gold) gold.style.display = "block";

  // Hide transactions table
  if (tx) tx.style.display = "none";
}

function openAddSheet() {
  document.getElementById('addOverlay').style.display = 'block';
  document.getElementById('addSheet').style.bottom = '0';
}

function closeAddSheet() {
  document.getElementById('addOverlay').style.display = 'none';
  document.getElementById('addSheet').style.bottom = '-100%';
}

function goTo(path) {
  window.location.href = path;
}

function triggerCsvUpload() {
  const file = document.getElementById("csvFileInput");
  file.click();
  file.onchange = () => file.files.length && document.getElementById("uploadCsvForm").submit();
}

document.addEventListener("DOMContentLoaded", function () {
  const path = window.location.pathname;
  const addBtn = document.getElementById("addBankBtn");
  const uploadForm = document.getElementById("uploadCsvForm");
  const csvTableInput = document.getElementById("csvTableName");

  const routeConfig = {
    "/bank_transactions": { add: "/add_bank_transaction", table: "Bank Transactions" },
    "/fd_transactions": { add: "/add_fd_transaction", table: "FD Transactions" },
    "/equity_transactions": { add: "/add_equity_transaction", table: "Equity Transactions" },
    "/mf_transactions": { add: "/add_mf_transaction", table: "Mutual Fund Transactions" },
    "/pf_transactions": { add: "/add_pf_transaction", table: "PF Transactions" },
    "/category_mapping": { add: "/add_category_mapping", table: "Category Mapping" },
    "/gold_transactions": { add: "/add_gold_transaction", table: "Gold Investments" },
     "/real_estate": { add: "//add_real_estate", table: "real estate" },
      "/private_equity": { add: "//add_private_equity", table: "private equity" },
      "/cash": { add: "//add_cash_investment", table: "cash" }
  };

  if (routeConfig[path]) {
    addBtn.style.display = "inline-block";
    addBtn.onclick = () => location.href = routeConfig[path].add;
    uploadForm.style.display = "inline-block";
    csvTableInput.value = routeConfig[path].table;
  }
});
</script>
</body>
</html>
